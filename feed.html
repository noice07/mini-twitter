<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FriendCircle Feed</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header>FriendCircle</header>

<main class="container">
  <h2 id="welcomeUser"></h2>

  <form id="postForm">
    <textarea id="message" placeholder="What's on your mind?"></textarea>
    <button type="submit">Post</button>
  </form>

  <div id="feed" class="feed"></div>
</main>

<footer>¬© 2025 FriendCircle</footer>

<script>
  const username = sessionStorage.getItem('username');
  if (!username) {
    alert("Please log in first.");
    window.location.href = "index.html";
  }

  document.getElementById("welcomeUser").textContent = `Hi, ${username} üëã`;

  const loadPosts = () => JSON.parse(localStorage.getItem("posts") || "[]");
  const savePosts = (posts) => localStorage.setItem("posts", JSON.stringify(posts));

  const profiles = JSON.parse(localStorage.getItem("profiles") || "{}");
  const feed = document.getElementById("feed");

  function renderPosts() {
    feed.innerHTML = "";
    const posts = loadPosts();
    posts.reverse().forEach((post, index) => {
      const authorProfile = profiles[post.author] || {};
      const avatar = authorProfile.pfp || "https://via.placeholder.com/40";
      const status = authorProfile.status || "";

      const postEl = document.createElement("div");
      postEl.className = "post";
      postEl.innerHTML = `
        <div class="post-header">
          <img src="${avatar}" alt="${post.author}" class="avatar" />
          <div class="user-info">
            <strong>${post.author}</strong><br/>
            <small>${status}</small>
          </div>
          ${post.author === username ? '<button class="delete-btn">üóëÔ∏è</button>' : ""}
        </div>
        <p>${post.message}</p>
        <div class="actions">
          <button class="like-btn">‚ù§Ô∏è Like</button>
          <span class="like-count">${post.likes || 0}</span>
        </div>
        <div class="comments">
          <input class="comment-input" placeholder="Write a comment..." />
          <button class="add-comment">Reply</button>
          <div class="comment-list">
            ${(post.comments || []).map(c => `<p class="comment"><strong>${c.user}:</strong> ${c.text}</p>`).join('')}
          </div>
        </div>
      `;

      const likeBtn = postEl.querySelector(".like-btn");
      const likeCount = postEl.querySelector(".like-count");
      likeBtn.addEventListener("click", () => {
        const allPosts = loadPosts();
        allPosts[allPosts.length - 1 - index].likes = (allPosts[allPosts.length - 1 - index].likes || 0) + 1;
        savePosts(allPosts);
        renderPosts();
      });

      if (post.author === username) {
        postEl.querySelector(".delete-btn").addEventListener("click", () => {
          const allPosts = loadPosts();
          allPosts.splice(allPosts.length - 1 - index, 1);
          savePosts(allPosts);
          renderPosts();
        });
      }

      const commentInput = postEl.querySelector(".comment-input");
      postEl.querySelector(".add-comment").addEventListener("click", () => {
        const comment = commentInput.value.trim();
        if (comment) {
          const allPosts = loadPosts();
          const targetPost = allPosts[allPosts.length - 1 - index];
          targetPost.comments = targetPost.comments || [];
          targetPost.comments.push({ user: username, text: comment });
          savePosts(allPosts);
          renderPosts();
        }
      });

      feed.appendChild(postEl);
    });
  }

  document.getElementById("postForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const message = document.getElementById("message").value.trim();
    if (!message) return;

    const posts = loadPosts();
    posts.push({ author: username, message, comments: [], likes: 0 });
    savePosts(posts);
    document.getElementById("message").value = "";
    renderPosts();
  });

  renderPosts();
</script>

</body>
</html>
